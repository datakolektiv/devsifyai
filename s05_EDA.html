<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Session05 Exploratory Data Analysis in R</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"><img id="logo" style="width: 30px;" src="DK_Logo_White_NoTitle_25.png" /></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Sessions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="s00_installations.html">S00. R and Python Installations</a>
    </li>
    <li>
      <a href="s01_introduction_to_r.html">S01. Introduction to R</a>
    </li>
    <li>
      <a href="s02_dataframe.html">S02. I/O, Packages, and data.frame</a>
    </li>
    <li>
      <a href="s03_functional.html">S03. Functional programming + Control flow in R</a>
    </li>
    <li>
      <a href="s04_more_functional.html">S04. More functional Programming + Basic Statistics in R</a>
    </li>
    <li>
      <a href="s05_EDA.html">S05. Exploratory Data Analysis (EDA)</a>
    </li>
    <li>
      <a href="s06_Probability.html">S06. Probability Theory</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="l01_lists.html">L01. Data Types, Lists</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Notes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="n00_installations.html">N00. R and Python Installations</a>
    </li>
    <li>
      <a href="n03_functional.html">N03. Functional Programming</a>
    </li>
    <li>
      <a href="n04_more_functional.html">N04. More Functional Programming</a>
    </li>
  </ul>
</li>
<li>
  <a href="video.html">Video</a>
</li>
<li>
  <a href="resources.html">Resources</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="media.html">Media</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Session05 Exploratory Data Analysis in
R</h1>
<h4 class="author">Goran S. Milovanovic, PhD</h4>

</div>


<p><img src="DK_Logo_100.png" /></p>
<hr />
<div id="exploratory-data-analysis-in-r" class="section level1">
<h1>Exploratory Data Analysis in R</h1>
<hr />
<div id="what-do-we-want-to-do-today" class="section level3">
<h3>What do we want to do today?</h3>
<p>This is the beginning of our journey into Data Science and Analytics
in R. Thus far, we have been learning about R programming, more or less
treating R as any other programming language. Now we begin to master the
real power of R in its areas of specialization: analytics, statistics,
machine learning, visualization, and reporting. And as you will see: in
statistics, nothing compares to R.</p>
<p>Exploratory Data Analysis (EDA) is a concept in Data
Analytics/Statistics promoted by John Tukey in the 60s who defined
<strong>data analysis</strong> as:</p>
<blockquote>
<p>“Procedures for analyzing data, techniques for interpreting the
results of such procedures, ways of planning the gathering of data to
make its analysis easier, more precise or more accurate, and all the
machinery and results of (mathematical) statistics which apply to
analyzing data.”</p>
</blockquote>
<p><a
href="https://en.wikipedia.org/wiki/Exploratory_data_analysis">Source:
Exploratory data analysis. (n.d.). In Wikipedia. Retrieved February 03,
2021</a></p>
<p>EDA is a set of procedures, not strictly standardized, that is used
to <em>understand</em> the data at hand before getting engaged in
statistical/machine learning, hypothesis testing, and other heavy
machinery found in the arsenal of contemporary Data Science. EDA is
pretty much a thinking and creative step: it is when hypothesis
generation should happen in the process. Before applying a statistical
model to our data sets we first need to understand the properties of the
data present there, and then only draw a conclusion on what mathematical
model exactly should be used to learn more from them. Of course,
hypothesis generation does not end in EDA. More often than not, one
<em>EDA -&gt; data modeling cycle</em> is followed by additional
insights that lead to hypotheses about the data. Then we go back and
perform some EDA again, and than perhaps model again, until we find out
what is the most useful that can be learned from the present data in
respect to the problem that we need to solve. In other words: EDA is
found pretty much at the very core of Data Science and Analytics.</p>
<p><strong>Data visualization is used heavily in the EDA
phase.</strong></p>
</div>
<div id="summarise-a-dataset" class="section level3">
<h3>1. Summarise a dataset</h3>
<div id="basic-descriptive-statistics" class="section level4">
<h4>1.1 Basic descriptive statistics</h4>
<p>We will begin by understanding what is in <code>mtcars</code>, a
famous dataset (<a
href="https://www.rdocumentation.org/packages/datasets/versions/3.6.2/topics/mtcars">see
mtcars documentation</a>) often used in educational purposes that is
built-in R:</p>
<pre class="r"><code>data(mtcars)
head(mtcars)</code></pre>
<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
<p>The shape of the <code>mtcars</code> data:</p>
<pre class="r"><code>print(paste0(&quot;mtcars has &quot;, 
             dim(mtcars)[1], 
             &quot; rows and &quot;, 
             dim(mtcars)[2], 
             &quot; columns.&quot;))</code></pre>
<pre><code>## [1] &quot;mtcars has 32 rows and 11 columns.&quot;</code></pre>
<p>Let’s remind ourselves of the base R <code>summary()</code>
function:</p>
<pre class="r"><code>summary(mtcars)</code></pre>
<pre><code>##       mpg             cyl             disp             hp             drat             wt       
##  Min.   :10.40   Min.   :4.000   Min.   : 71.1   Min.   : 52.0   Min.   :2.760   Min.   :1.513  
##  1st Qu.:15.43   1st Qu.:4.000   1st Qu.:120.8   1st Qu.: 96.5   1st Qu.:3.080   1st Qu.:2.581  
##  Median :19.20   Median :6.000   Median :196.3   Median :123.0   Median :3.695   Median :3.325  
##  Mean   :20.09   Mean   :6.188   Mean   :230.7   Mean   :146.7   Mean   :3.597   Mean   :3.217  
##  3rd Qu.:22.80   3rd Qu.:8.000   3rd Qu.:326.0   3rd Qu.:180.0   3rd Qu.:3.920   3rd Qu.:3.610  
##  Max.   :33.90   Max.   :8.000   Max.   :472.0   Max.   :335.0   Max.   :4.930   Max.   :5.424  
##       qsec             vs               am              gear            carb      
##  Min.   :14.50   Min.   :0.0000   Min.   :0.0000   Min.   :3.000   Min.   :1.000  
##  1st Qu.:16.89   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:3.000   1st Qu.:2.000  
##  Median :17.71   Median :0.0000   Median :0.0000   Median :4.000   Median :2.000  
##  Mean   :17.85   Mean   :0.4375   Mean   :0.4062   Mean   :3.688   Mean   :2.812  
##  3rd Qu.:18.90   3rd Qu.:1.0000   3rd Qu.:1.0000   3rd Qu.:4.000   3rd Qu.:4.000  
##  Max.   :22.90   Max.   :1.0000   Max.   :1.0000   Max.   :5.000   Max.   :8.000</code></pre>
<p><code>summary()</code> is the simplest possible way to obtain the
basic statistics of a dataset in R. As you can see, for each variable in
<code>mtcars</code>, we have obtained: (a) its minimum, (b) its maximum,
(c) its mean and median as measures of central tendency, (d) the value
of Q1 which is the 25th quantile indeed and the value of Q3 which is the
75th quantile (to be explained in the session).</p>
<p>Of course we can ask for any of these statistics for any of the
variables present in <code>mtcars</code> separately, e.g.:</p>
<pre class="r"><code>mean(mtcars$qsec)</code></pre>
<pre><code>## [1] 17.84875</code></pre>
<pre class="r"><code>median(mtcars$qsec)</code></pre>
<pre><code>## [1] 17.71</code></pre>
<pre class="r"><code>min(mtcars$qsec)</code></pre>
<pre><code>## [1] 14.5</code></pre>
<pre class="r"><code>max(mtcars$qsec)</code></pre>
<pre><code>## [1] 22.9</code></pre>
<p>What is the range of <code>mtcars$qsec</code> - the difference
between its maximum and minimum?</p>
<pre class="r"><code>range(mtcars$qsec)</code></pre>
<pre><code>## [1] 14.5 22.9</code></pre>
<p>So the first element is the minimum and the second is the maximum.
Then, maybe:</p>
<pre class="r"><code># NOTE: study this
rangeQsec &lt;- abs(Reduce(&quot;-&quot;, range(mtcars$qsec)))
print(rangeQsec)</code></pre>
<pre><code>## [1] 8.4</code></pre>
<p>And <code>abs()</code> is, of course, to obtain the absolute
value.</p>
<p>Let’s talk about quantiles now:</p>
<pre class="r"><code>quantile(mtcars$qsec, probs = .25)</code></pre>
<pre><code>##     25% 
## 16.8925</code></pre>
<pre class="r"><code>quantile(mtcars$qsec, probs = c(.25, .5, .75))</code></pre>
<pre><code>##     25%     50%     75% 
## 16.8925 17.7100 18.9000</code></pre>
<p>And the 50% quantile is the <em>median</em> of the
<code>mtcars$qsec</code> variable.</p>
</div>
<div id="the-boxplot-base-r-and-then-ggplot2" class="section level4">
<h4>1.2 The Boxplot: base R and then {ggplot2}</h4>
<p>Numbers and numbers only… Data visualization is <em>way better</em>
to understand the data than by just looking at numbers. Let’s begin with
the base R function <code>boxplot()</code> to visualize only one
variable, <code>mtcars$qsec</code>, and learn what boxplots are for. As
you will see, they are among the most helpful tools to understand the
distribution of the values of some measurement in statistics.</p>
<pre class="r"><code>boxplot(mtcars$qsec,
        horizontal = TRUE, 
        xlab = &quot;qsec&quot;,
        col = &quot;darkorange&quot;,
        main = &quot;Boxplot: qsec&quot;)</code></pre>
<p><img src="s05_EDA_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>The thick line in the box stands where the <em>median</em> of the
<code>mtcars$qsec</code> is found. The box is bounded by Q1 (25%) from
the left and Q3 (75%) from the right. The width of the box thus equates
the <strong>IQR</strong> - Interquartile Range - which is the difference
between Q3 and Q1: <code>IQR = Q3 - Q1</code>. What about the length of
the whiskers, and why is there that lonely point to the right marked?
That needs some discussion:</p>
<pre class="r"><code>## NOTE: Boxplot &quot;fences&quot; and outlier detection
# Q3 = 75 percentile, Q1 = 25 percentile
Q3 &lt;- quantile(mtcars$qsec, .75)
Q3</code></pre>
<pre><code>##  75% 
## 18.9</code></pre>
<pre class="r"><code>Q1 &lt;- quantile(mtcars$qsec, .25)
Q1</code></pre>
<pre><code>##     25% 
## 16.8925</code></pre>
<pre class="r"><code># IQ = Q3 - Q1; Interquartile range
IQR &lt;- unname(Q3 - Q1)
IQR</code></pre>
<pre><code>## [1] 2.0075</code></pre>
<p>The definitions of the fences used in R are:</p>
<ul>
<li>Lower inner fence: <code>Q1 - 1.5*IQR</code></li>
<li>Upper inner fence: <code>Q3 + 1.5*IQR</code></li>
<li>Lower outer fence: <code>Q1 - 3*IQR</code></li>
<li>Upper outer fence: <code>Q3 + 3*IQR</code></li>
<li>A point beyond an inner fence on either side is considered a
<strong>mild outlier</strong></li>
<li>A point beyond an outer fence is considered an <strong>extreme
outlier</strong></li>
</ul>
<p>Now, let’s find out about the outlier to the right of the boxplot’s
whiskers in our plot:</p>
<pre class="r"><code>lif &lt;- Q1 - 1.5*IQR
uif &lt;- Q3 + 1.5*IQR
lof &lt;- Q1 - 3*IQR
uof &lt;- Q3 + 3*IQR
mtcars$qsec[mtcars$qsec &gt; uif]</code></pre>
<pre><code>## [1] 22.9</code></pre>
<pre class="r"><code>mtcars$qsec[mtcars$qsec &gt; uof]</code></pre>
<pre><code>## numeric(0)</code></pre>
<p>Conclusion: there is one point in <code>mtcars$qsec</code> that is
positioned above the <em>upper inner fence</em> in the boxplot, and that
one point represents a <em>mild outlier</em> because it does not go
beyond the <em>upper outter fence</em>. There are no outliers bellow
lower fences in <code>mtcars$qsec</code>.</p>
<p>We have found one outlier… And that would be your first step on the
road to anomaly detection in Data Science!</p>
<p>Now, can we visualize more than one variable in the
<code>mtcars</code> dataset and thus try to understand the dataset as a
whole, or at least a large part of it? Of course:</p>
<pre class="r"><code>boxplot(mtcars[ , c(&#39;mpg&#39;, &#39;disp&#39;, &#39;hp&#39;, &#39;drat&#39;, &#39;wt&#39;, &#39;qsec&#39;)], 
        horizontal = FALSE, 
        xlab=&quot;qsec&quot;,
        ylab = &quot;value&quot;,
        col = &quot;darkorange&quot;,
        main = &quot;Boxplot&quot;)</code></pre>
<p><img src="s05_EDA_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>But the variables seem to be on different scales. What can often help
in situations like this one is to use the <em>logarithmic
scaling</em>:</p>
<pre class="r"><code>boxplot(mtcars[ , c(&#39;mpg&#39;, &#39;disp&#39;, &#39;hp&#39;, &#39;drat&#39;, &#39;wt&#39;, &#39;qsec&#39;)], 
        horizontal = FALSE, 
        xlab=&quot;qsec&quot;,
        ylab = &quot;log(value)&quot;,
        log = &quot;y&quot;,
        col = &quot;indianred&quot;,
        main = &quot;Boxplot: qsec&quot;)</code></pre>
<p><img src="s05_EDA_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>While even base R offers great means to visualize data, {ggplot2} is
the industrial standard data visualization package and it is definitely
way, way better. We will now begin our study of the anatomy of a ggplot2
plot using our boxplot as an example.</p>
<p>In order to produce a boxplot with ggplot2, mtcars first need to be
transformed from the <em>wide data representation</em> format into a
<em>long data representation format</em>:</p>
<pre class="r"><code># load tidyverse
library(tidyverse)

# introduce id column
mtcars$id &lt;- 1:dim(mtcars)[1]

# wide to long transform
mtcarsPlot &lt;- mtcars %&gt;%
  dplyr::select(id, mpg, disp, hp, drat, wt, qsec) %&gt;% 
  tidyr::pivot_longer(cols = -id,
                      names_to = &quot;Measurement&quot;,
                      values_to = &quot;Value&quot;)

head(mtcarsPlot, 30)</code></pre>
<pre><code>## # A tibble: 30 × 3
##       id Measurement  Value
##    &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
##  1     1 mpg          21   
##  2     1 disp        160   
##  3     1 hp          110   
##  4     1 drat          3.9 
##  5     1 wt            2.62
##  6     1 qsec         16.5 
##  7     2 mpg          21   
##  8     2 disp        160   
##  9     2 hp          110   
## 10     2 drat          3.9 
## # ℹ 20 more rows</code></pre>
<p>Do you understand the difference between <strong>long</strong> and
<strong>wide</strong> data formats? We will discuss it live in our
session! The <code>select()</code> function used in the code above is
from the <code>{dplyr}</code> package: it simply selects only the
desired columns from a dataframe. Then, the <code>pivot_longer()</code>
function, from the <code>{tidyr}</code> package, transform the wide
<code>mtcars</code>into the long <code>mtcarsPlot</code> following the
addition of the <code>id</code> column to <code>mtcars</code> because we
want to keep track of the mapping between models (i.e. rows, records) in
the original dataset and its long format!</p>
<p>Here is a step by step analysis of the code above:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Adding an <code>id</code> column to the
<code>mtcars</code> data frame:</strong></p>
<pre class="r"><code>mtcars$id &lt;- 1:dim(mtcars)[1]</code></pre>
<ul>
<li><code>mtcars</code> is a built-in data frame in R that contains
various automobile data.</li>
<li><code>dim(mtcars)[1]</code> retrieves the number of rows in the
<code>mtcars</code> data frame because <code>dim()</code> returns the
dimensions of an object as a vector where the first element is the
number of rows and the second element is the number of columns.</li>
<li><code>1:dim(mtcars)[1]</code> creates a sequence of numbers starting
from 1 to the number of rows in <code>mtcars</code>.</li>
<li><code>mtcars$id &lt;-</code> assigns this sequence to a new column
in the <code>mtcars</code> data frame named <code>id</code>. This
<code>id</code> column now acts as a unique identifier for each row
(each car).</li>
</ul></li>
<li><p><strong>Creating a new data frame <code>mtcarsPlot</code> by
selecting and transforming the <code>mtcars</code> data
frame:</strong></p>
<pre class="r"><code>mtcarsPlot &lt;- mtcars %&gt;%
  dplyr::select(id, mpg, disp, hp, drat, wt, qsec) %&gt;% 
  tidyr::pivot_longer(cols = -id,
                      names_to = &quot;Measurement&quot;,
                      values_to = &quot;Value&quot;)</code></pre>
<ul>
<li><code>mtcars %&gt;%</code> takes the <code>mtcars</code> data frame
and passes it on to the next function in the pipeline (denoted by
<code>%&gt;%</code>).</li>
<li><code>dplyr::select(id, mpg, disp, hp, drat, wt, qsec)</code> uses
the <code>select</code> function from the <code>dplyr</code> package to
keep only the columns <code>id</code>, <code>mpg</code> (miles per
gallon), <code>disp</code> (displacement), <code>hp</code> (horsepower),
<code>drat</code> (rear axle ratio), <code>wt</code> (weight), and
<code>qsec</code> (1/4 mile time).</li>
<li><code>tidyr::pivot_longer(cols = -id, names_to = "Measurement", values_to = "Value")</code>
transforms the data frame from wide to long format using
<code>pivot_longer</code> from the <code>tidyr</code> package:
<ul>
<li><code>cols = -id</code> indicates that all columns except
<code>id</code> should be transformed into two new columns.</li>
<li><code>names_to = "Measurement"</code> specifies that the original
column names (like <code>mpg</code>, <code>disp</code>, etc.) should be
placed in a new column called <code>Measurement</code>.</li>
<li><code>values_to = "Value"</code> specifies that the values from the
original columns should be placed in a new column called
<code>Value</code>.</li>
</ul></li>
</ul>
<p>The result of this transformation (<code>mtcarsPlot</code>) is a
longer format data frame where each row represents one measurement (like
<code>mpg</code> or <code>hp</code>) of a car. The <code>id</code>
column links each measurement back to the original row in
<code>mtcars</code>, making it easier to perform grouped analyses or
plots where each car’s multiple attributes are needed in a tidy format.
This format is particularly useful for plotting or statistical analysis
in R.</p></li>
</ol>
<p>Now, the boxplot with {ggplot2}:</p>
<pre class="r"><code>ggplot(data = mtcarsPlot, 
       aes(x = Measurement, 
           y = Value, 
           fill = Measurement)) +
  geom_boxplot() + 
  ggtitle(&quot;mtcars boxplot&quot;) + 
  theme_bw() + 
  theme(panel.border = element_blank()) + 
  theme(plot.title = element_text(hjust = .5)) +
  theme(legend.position = &quot;right&quot;)</code></pre>
<p><img src="s05_EDA_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p><strong>Note.</strong> We use <code>+</code> to chain the layers in
{ggplot2} visualizations, similarly as we use the pipes to chain data
transformations. Do not confuse <code>+</code> as used to build a
{ggplot2} visualization with <code>+</code> as an arithmetic operation
or <code>%&gt;%</code>.</p>
<p>We will play with various transformations of this boxplot in our
session to learn about the basics of the fantastic, powerful {ggplot2}
package! For example, let’s produce a <strong>scatterplot</strong> -
another very important visualization in statistics and analytics to
learn about - of two variables from <code>mtcars</code> with {ggplot2},
just to see how easy it is:</p>
<pre class="r"><code>ggplot(data = mtcars, 
       aes(x = hp, 
           y = qsec)) + 
  geom_point(size = 2, color = &quot;darkred&quot;) +
  ggtitle(&quot;mtcars: hp vs. qsec&quot;) + 
  theme_bw() +
  theme(panel.border = element_blank()) + 
  theme(plot.title = element_text(hjust = .5))</code></pre>
<p><img src="s05_EDA_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p><strong>Hypothesis.</strong> There is a negative linear relationship
between <code>mtcars$hp</code> and <code>mtcars$qsec</code>. Let’s
see:</p>
<pre class="r"><code>ggplot(data = mtcars, 
       aes(x = hp, 
           y = qsec)) + 
  geom_smooth(method = &quot;lm&quot;, size = .25, color = &quot;darkblue&quot;) + 
  geom_point(size = 2, color = &quot;cadetblue3&quot;) +
  ggtitle(&quot;mtcars: hp vs. qsec&quot;) +
  theme_bw() +
  theme(panel.border = element_blank()) + 
  theme(plot.title = element_text(hjust = .5))</code></pre>
<p><img src="s05_EDA_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Can our hypothesis be falsified? We will see in the remainder of the
course. Now back to the EDA things! Before that, just another {ggplot2}
trick to help you understand your data better…</p>
<pre class="r"><code>mtcarsPlot &lt;- mtcars %&gt;% 
  dplyr::select(hp, qsec)

mtcarsPlot$label &lt;- paste0(&quot;(&quot;, 
                           mtcarsPlot$hp, &quot;, &quot;, 
                           mtcarsPlot$qsec, 
                           &quot;)&quot;)
ggplot(data = mtcarsPlot, 
       aes(x = hp, 
           y = qsec, 
           label = label)) + 
  geom_smooth(method = &quot;lm&quot;, size = .25, color = &quot;cadetblue3&quot;) + 
  geom_point(size = 2, color = &quot;cadetblue3&quot;) +
  geom_text(size = 2) + 
  ggtitle(&quot;mtcars: hp vs. qsec&quot;) + 
  theme_bw() +
  theme(panel.border = element_blank()) + 
  theme(plot.title = element_text(hjust = .5))</code></pre>
<p><img src="s05_EDA_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Not readable enough? <code>install.packages(ggrepel)</code>. Now,</p>
<pre class="r"><code>library(ggrepel)
mtcarsPlot &lt;- mtcars %&gt;% 
  select(hp, qsec)
mtcarsPlot$label &lt;- paste0(&quot;(&quot;, 
                           mtcarsPlot$hp, &quot;, &quot;, 
                           mtcarsPlot$qsec, 
                           &quot;)&quot;)
ggplot(data = mtcarsPlot, 
       aes(x = hp, 
           y = qsec, 
           label = label)) + 
  geom_smooth(method = &quot;lm&quot;, size = .25, color = &quot;cadetblue3&quot;) + 
  geom_point(size = 1.5, color = &quot;cadetblue3&quot;) +
  geom_text_repel(size = 2.5) + 
  ggtitle(&quot;mtcars: hp vs. qsec&quot;) + 
  theme(panel.border = element_blank()) + 
  theme(plot.title = element_text(hjust = .5))</code></pre>
<p><img src="s05_EDA_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
</div>
</div>
<div id="distributions-and-histograms" class="section level3">
<h3>2. Distributions and histograms</h3>
<p><strong>Q.</strong> How is the number of cylinders -
<code>mtcars$cyl</code> - distributed across the models in the
dataset?</p>
<pre class="r"><code>mtcarsPlot &lt;- mtcars %&gt;% 
  dplyr::select(cyl) %&gt;% 
  dplyr::group_by(cyl) %&gt;% 
  dplyr::summarise(count = n())
mtcarsPlot</code></pre>
<pre><code>## # A tibble: 3 × 2
##     cyl count
##   &lt;dbl&gt; &lt;int&gt;
## 1     4    11
## 2     6     7
## 3     8    14</code></pre>
<p>I have used <code>dplyr::select()</code> to single out only the
<code>cyl</code> variable, then <em>grouped</em> the data with
<code>dplyr::group_by</code> to be able to aggregate across the distinct
values in <code>cyl</code>, and finally used
<code>dplyr::summarise()</code> to compute a new variable,
<code>count</code>, in <code>mtcarsPlot</code>, by the
<code>dplyr::n()</code> function which simply counts the number of
elements in each group following <code>dplyr::group_by</code>. The
chart:</p>
<pre class="r"><code>ggplot(data = mtcarsPlot, 
       aes(x = cyl, 
           y = count)) + 
  geom_bar(stat = &quot;identity&quot;, fill = &quot;cadetblue4&quot;, width = .5) + 
  ggtitle(&quot;Number of cylinders across the models found in mtcars&quot;) +
  theme(panel.border = element_blank()) + 
  theme(plot.title = element_text(hjust = .5))</code></pre>
<p><img src="s05_EDA_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<p>How about the distribution of continuous variables? Remember our
Exercises in Session03?</p>
<pre class="r"><code>ggplot(mtcars, 
       aes(x = hp, 
           fill = cyl, 
           group = cyl)) + 
  geom_density(alpha = .15, color = &quot;black&quot;) + 
  ggtitle(&quot;Distrubutions of hp across cyl&quot;) + 
  xlab(&#39;hp&#39;) + 
  ylab(&#39;Density&#39;) + 
  theme_bw() + 
  theme(panel.border = element_blank()) +
  theme(plot.title = element_text(hjust = .5))</code></pre>
<p><img src="s05_EDA_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Fine, but… <code>mtcars$cyl</code> needs to become an R
<strong>factor</strong> first!</p>
<pre class="r"><code>mtcars$cyl &lt;- as.factor(mtcars$cyl)
ggplot(mtcars, 
       aes(x = hp, 
           fill = cyl, 
           group = cyl)) + 
  geom_density(alpha = .15, color = &quot;black&quot;) + 
  ggtitle(&quot;Distrubutions of hp across cyl&quot;) + 
  xlab(&#39;hp&#39;) + 
  ylab(&#39;Density&#39;) + 
  theme_bw() + 
  theme(panel.border = element_blank()) +
  theme(plot.title = element_text(hjust = .5))</code></pre>
<p><img src="s05_EDA_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>The overall distribution of <code>mtcars$hp</code> is:</p>
<pre class="r"><code>ggplot(mtcars, 
       aes(x = hp)) + 
  geom_density(alpha = .15, color = &quot;black&quot;, fill = &quot;darkorange&quot;) + 
  ggtitle(&quot;Distrubution of hp in mtcars&quot;) + 
  xlab(&#39;hp&#39;) + 
  ylab(&#39;Density&#39;) + 
  theme_bw() + 
  theme(panel.border = element_blank()) +
  theme(plot.title = element_text(hjust = .5))</code></pre>
<p><img src="s05_EDA_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
</div>
<div id="cross-tabulations-and-aggregations" class="section level3">
<h3>3. Cross-Tabulations and Aggregations</h3>
<p><strong>Q.</strong> How is the average <code>qsec</code> distributed
across <code>cyl</code> and <code>gear</code> in
<code>mtcars</code>?</p>
<pre class="r"><code>distribution &lt;- 
  mtcars %&gt;% 
  dplyr::select(cyl, gear, qsec) %&gt;% 
  dplyr::group_by(cyl, gear) %&gt;% 
  dplyr::summarise(meanQsec = mean(qsec),
                   count = n())
print(distribution)</code></pre>
<pre><code>## # A tibble: 8 × 4
## # Groups:   cyl [3]
##   cyl    gear meanQsec count
##   &lt;fct&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;int&gt;
## 1 4         3     20.0     1
## 2 4         4     19.6     8
## 3 4         5     16.8     2
## 4 6         3     19.8     2
## 5 6         4     17.7     4
## 6 6         5     15.5     1
## 7 8         3     17.1    12
## 8 8         5     14.6     2</code></pre>
<p>Now, one of my favorite {ggplot2} tricks to visualize a dataset like
this one:</p>
<pre class="r"><code>ggplot(distribution, 
       aes(x = cyl, 
           y = gear, 
           size = meanQsec, 
           label = meanQsec)) + 
  geom_point(color = &quot;cadetblue3&quot;) +
  ggtitle(&quot;Mean qsec across cyl and gear in mtcars&quot;) + 
  geom_text_repel(size = 3) + 
  theme_bw() + 
  theme(panel.border = element_blank()) +
  theme(plot.title = element_text(hjust = .5))</code></pre>
<p><img src="s05_EDA_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>Or you can use <code>facet_warp()</code> in {ggplot2}:</p>
<pre class="r"><code>ggplot(distribution, 
       aes(x = gear, 
           y = meanQsec, 
           label = meanQsec)) + 
  geom_bar(stat = &quot;identity&quot;, 
           color = &quot;black&quot;, 
           fill = &quot;darkorange&quot;) +
  facet_wrap(~cyl) + 
  ggtitle(&quot;Mean qsec across cyl and gear in mtcars&quot;) + 
  geom_text_repel(size = 3) + 
  theme_bw() + 
  theme(panel.border = element_blank()) +
  theme(plot.title = element_text(hjust = .5))</code></pre>
<p><img src="s05_EDA_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<hr />
</div>
<div id="further-readings" class="section level3">
<h3>Further Readings</h3>
<ul>
<li><a
href="https://r4ds.had.co.nz/exploratory-data-analysis.html">Chapter 7,
Exploratory Data Analysis, from from R for Data Science, Hadley Wickham
&amp; Garrett Grolemund</a></li>
</ul>
</div>
<div id="important-sources-documentation-etc." class="section level3">
<h3>Important sources, documentation, etc.</h3>
<ul>
<li><a href="https://adv-r.hadley.nz/index.html">Advanced R, Hadley
Wickham, 2nd edition</a></li>
<li><a href="https://www.statmethods.net/">Quick-R</a> - An excellent
set of concise R tutorials.</li>
<li><a href="https://cran.r-project.org/">CRAN: The Comprehensive R
Archive Network</a> - This is were the official versions of R packages
live</li>
<li><a
href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;ved=2ahUKEwjXhNPIu_TtAhVSkMMKHRx6A3QQFjABegQIAhAC&amp;url=http%3A%2F%2Fwww.stat.columbia.edu%2F~tzheng%2Ffiles%2FRcolor.pdf&amp;usg=AOvVaw1XIn-mwZ73RgG8bxh4Lan4">Colors
in R (PDF)</a></li>
<li><a href="https://ggplot2.tidyverse.org/reference/">ggplot2
Reference</a></li>
<li><a href="https://www.rdocumentation.org/">RDocumentation: Search all
21,217 CRAN, Bioconductor and GitHub packages</a></li>
</ul>
</div>
<div id="r-markdown" class="section level3">
<h3>R Markdown</h3>
<p><a href="https://rmarkdown.rstudio.com/">R Markdown</a> is what I
have used to produce this beautiful Notebook. We will learn more about
it near the end of the course, but if you already feel ready to dive
deep, here’s a book: <a href="https://bookdown.org/yihui/rmarkdown/">R
Markdown: The Definitive Guide, Yihui Xie, J. J. Allaire, Garrett
Grolemunds.</a></p>
<hr />
<p>License: <a href="http://www.gnu.org/licenses/gpl-3.0.txt">GPLv3</a>
This Notebook is free software: you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the
Free Software Foundation, either version 3 of the License, or (at your
option) any later version. This Notebook is distributed in the hope that
it will be useful, but WITHOUT ANY WARRANTY; without even the implied
warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details. You should have received a
copy of the GNU General Public License along with this Notebook. If not,
see <a href="http://www.gnu.org/licenses/"
class="uri">http://www.gnu.org/licenses/</a>.</p>
<hr />
</div>
</div>

<hr>
<p style="text-align:center;">
  <img src="DK_Logo_White_150.png">
</p>
<p style="font-size:13px;text-align:center;">
  <b>Contact: </b><a href = "mailto: goran.milovanovic@datakolektiv.com">goran.milovanovic@datakolektiv.com</a><br><br><a href="https://github.com/datakolektiv"><img src="github.png"></a>&nbsp;&nbsp;<a href="https://www.linkedin.com/in/gmilovanovic/"><img src="linkedin.png"></a>
</p>
<p style="font-size:11px;text-align:center;"><b>Impressum</b><br>
<b>Data Kolektiv, 2004, Belgrade.</b></p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
